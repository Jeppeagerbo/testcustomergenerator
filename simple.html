<!DOCTYPE>
<html>
<head>
    <title>Mobile Banking App API</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
</html>
<body>
  <script type="application/javascript">    
    function generate_cprtestparameters () {
      var date; // TODO: Generate date with age over 18
      // Generate CPR numbers for this date
      var cprgenerator = new GenerateDKPersonalIds("MALE", new Date("October 13, 2014 11:13:00"));
      var cpr = (cprgenerator.generate())[0];
      
      // Generate random firstname
      var firstname; 
      var lastname;
      
      var data = { 
          "updateFormCpr=" : cpr,
          "firstmiddlename" : firstname,
          "lastname": lastname,
          "addressingname": "",
          "standardAddress": "Vejnavn+1",
          "zipCode": "8000",
          "zipCity": "Aarhus",
          "countryCode": "DK",
          "status": "01",
          "currentCpr": "",
          "delaySeconds": 0,
          "btnCreate": "Create"
    };
    
    $(function() {
      var cprsimurlbase = "https://idk0danadmdf.intranet.pbs/simulator/cpr";
      var cprgenerator = new GenerateDKPersonalIds("MALE", new Date("October 13, 2014 11:13:00"));
      var cpr = cprgenerator.generate();
      debugger;
      $.get("")
    });
  </script>
  
  <script type="application/javascript">
    function calculateModules11(id, to) {
        var multiply = [4, 3, 2, 7, 6, 5, 4, 3, 2, 1];
        var sum = 0;
        var pos = 0;
        var i;
        for (i = 0; i < to; i++) {
                var x = id.substring(pos, pos + 1);
                var intValue = parseInt(x, 10);
                sum += intValue * multiply[i];
                if (i === 5) {
                        pos++; //Ignore dash
                }
                pos++;
        }
        return sum;
    }
    function GenerateDKPersonalIds(gender, birthdate) {
        this.gender = gender;
        this.birthdate = birthdate;
        
        this.generate = function() {
                var fixpart = "";
                var day = birthdate.getDate();
                if (day < 10) {
                        fixpart += "0";
                }
                fixpart += day;
                var month = birthdate.getMonth() + 1;
                if (month < 10) {
                        fixpart += "0";
                }
                fixpart += month;
                var fullYear = birthdate.getFullYear().toString();
                var strYear = fullYear;
                fixpart += strYear.substring(2, 4);
                fixpart += "-"; 
                
                var result = [];
                var valid8Digits = this.getValid8Digits(fullYear);
                var counter = 0;
                var next8Digit;
                var nextSerialNumber;
                for(next8Digit = 0; next8Digit < valid8Digits.length; next8Digit++) {
                        for (nextSerialNumber = 0; nextSerialNumber <= 99; nextSerialNumber++) {
                                var nextId = fixpart;
                                nextId += valid8Digits[next8Digit];
                                if (nextSerialNumber < 10) {
                                        nextId += "0";
                                }
                                nextId += nextSerialNumber;
                                var sum = calculateModules11(nextId, 9);
                    var remainder = sum % 11;
                    var modulus11 = 0;
                    if (remainder !== 0) {
                                        modulus11 = 11 - remainder;
                                }
                                if (modulus11 < 10) {
                                        nextId += modulus11;
                                        if (modulus11 % 2 === 0 && gender === "FEMALE") {
                                                result.push(nextId);
                                                counter++;
                                        }
                                        else if (modulus11 % 2 !== 0 && gender === "MALE") {
                                                result.push(nextId);
                                                counter++;
                                        }
                                }
                        }
                }
                return result;
        };
        
        this.getValid8Digits = function(fullYear) {
                var century = Math.floor(fullYear / 100);
                var year = fullYear % 100;
                var valid8Digits = [];
                var nextElement = 0;

        if (century === 19) {
            valid8Digits[nextElement++] = 0;
            valid8Digits[nextElement++] = 1;
            valid8Digits[nextElement++] = 2;
            valid8Digits[nextElement++] = 3;
            if (year >= 37)
            {
                                valid8Digits[nextElement++] = 4;
                                valid8Digits[nextElement++] = 9;
            }
        }
        else if (century === 20) {
            if (year < 37) {
                                valid8Digits[nextElement++] = 4;
            }
            if (year <= 57) {
                                valid8Digits[nextElement++] = 5;
                                valid8Digits[nextElement++] = 6;
                                valid8Digits[nextElement++] = 7;
                                valid8Digits[nextElement++] = 8;
            }
            if (year <= 36) {
                                valid8Digits[nextElement++] = 9;
                        }
        }
        else if (century === 18) {
            if (year > 57) {
                                valid8Digits[nextElement++] = 5;
                                valid8Digits[nextElement++] = 6;
                                valid8Digits[nextElement++] = 7;
                                valid8Digits[nextElement++] = 8;
            }
        }
        return valid8Digits;
        };
}
  </script>
  
</body>
</html>